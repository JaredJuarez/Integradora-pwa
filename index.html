<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Progressive Web App - Sistema de Gestión"
    />
    <meta name="theme-color" content="#4F46E5" />
    <title>PWA Sistema de Gestión</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/styles.css" />

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="assets/images/icons/icon-192x192.png" />
  </head>
  <body class="bg-gray-100">
    <!-- Loader -->
    <div
      id="loader"
      class="fixed inset-0 bg-white z-50 flex items-center justify-center hidden"
    >
      <div
        class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-indigo-500"
      ></div>
    </div>

    <!-- Landing Page -->
    <div class="min-h-screen flex flex-col">
      <!-- Header -->
      <header class="bg-white shadow-sm">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16">
            <div class="flex items-center">
              <i class="fas fa-store text-3xl text-indigo-600"></i>
              <span class="ml-2 text-2xl font-bold text-gray-900"
                >PWA Sistema</span
              >
            </div>
            <div class="flex items-center space-x-4">
              <a
                href="pages/auth/login.html"
                class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium"
              >
                Iniciar Sesión
              </a>
              <a
                href="pages/auth/registro.html"
                class="bg-indigo-600 text-white hover:bg-indigo-700 px-4 py-2 rounded-md text-sm font-medium"
              >
                Registrarse
              </a>
            </div>
          </div>
        </nav>
      </header>

      <!-- Hero Section -->
      <main class="flex-grow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
          <div class="text-center">
            <h1
              class="text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl"
            >
              <span class="block">Sistema de Gestión</span>
              <span class="block text-indigo-600">Progressive Web App</span>
            </h1>
            <p
              class="mt-3 max-w-md mx-auto text-base text-gray-500 sm:text-lg md:mt-5 md:text-xl md:max-w-3xl"
            >
              Sistema de gestión de rutas de empleados y administración de
              tiendas. Funciona online y offline.
            </p>
            <div
              class="mt-5 max-w-md mx-auto sm:flex sm:justify-center md:mt-8"
            >
              <div class="rounded-md shadow">
                <a
                  href="pages/auth/login.html"
                  class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10"
                >
                  Comenzar
                </a>
              </div>
              <div class="mt-3 rounded-md shadow sm:mt-0 sm:ml-3">
                <button
                  id="installBtn"
                  class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg md:px-10 hidden"
                >
                  <i class="fas fa-download mr-2"></i> Instalar App
                </button>
              </div>
            </div>
          </div>

          <!-- Features -->
          <div class="mt-20">
            <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
              <!-- Feature 1 -->
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i
                        class="fas fa-user-shield text-3xl text-indigo-600"
                      ></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dt class="text-lg font-medium text-gray-900 truncate">
                        Administración
                      </dt>
                      <dd class="mt-1 text-sm text-gray-500">
                        Gestión completa de usuarios, productos y reportes
                      </dd>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Feature 2 -->
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-truck text-3xl text-indigo-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dt class="text-lg font-medium text-gray-900 truncate">
                        Rutas de Empleados
                      </dt>
                      <dd class="mt-1 text-sm text-gray-500">
                        Gestión de rutas y visitas a tiendas
                      </dd>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Feature 3 -->
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-qrcode text-3xl text-indigo-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dt class="text-lg font-medium text-gray-900 truncate">
                        Escaneo QR
                      </dt>
                      <dd class="mt-1 text-sm text-gray-500">
                        Verificación de ubicación por código QR
                      </dd>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Feature 4 -->
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-wifi text-3xl text-indigo-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dt class="text-lg font-medium text-gray-900 truncate">
                        Modo Offline
                      </dt>
                      <dd class="mt-1 text-sm text-gray-500">
                        Funciona sin conexión a internet
                      </dd>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Feature 5 -->
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-bell text-3xl text-indigo-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dt class="text-lg font-medium text-gray-900 truncate">
                        Notificaciones
                      </dt>
                      <dd class="mt-1 text-sm text-gray-500">
                        Alertas en tiempo real
                      </dd>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Feature 6 -->
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-camera text-3xl text-indigo-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dt class="text-lg font-medium text-gray-900 truncate">
                        Documentación
                      </dt>
                      <dd class="mt-1 text-sm text-gray-500">
                        Fotos y reportes de cada visita
                      </dd>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="bg-white">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
          <p class="text-center text-gray-500 text-sm">
            &copy; 2025 PWA Sistema de Gestión. Todos los derechos reservados.
          </p>
        </div>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="assets/js/app.js"></script>

    <!-- PWA Installation and Service Worker -->
    <script>
      // Variables globales para PWA
      let deferredPrompt;
      const installBtn = document.getElementById("installBtn");

      // Registro del Service Worker
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", async () => {
          try {
            const registration = await navigator.serviceWorker.register(
              "./sw.js",
              {
                scope: "./",
              }
            );
            console.log(
              "ServiceWorker registration successful with scope: ",
              registration.scope
            );

            // Verificar si hay actualizaciones
            registration.addEventListener("updatefound", () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener("statechange", () => {
                  if (newWorker.state === "installed") {
                    if (navigator.serviceWorker.controller) {
                      // Nueva versión disponible
                      if (
                        confirm(
                          "Nueva versión disponible. ¿Recargar la aplicación?"
                        )
                      ) {
                        window.location.reload();
                      }
                    }
                  }
                });
              }
            });
          } catch (err) {
            console.log("ServiceWorker registration failed: ", err);
          }
        });
      }

      // Manejar evento beforeinstallprompt
      window.addEventListener("beforeinstallprompt", (e) => {
        console.log("PWA: beforeinstallprompt fired");
        e.preventDefault();
        deferredPrompt = e;
        installBtn.classList.remove("hidden");
      });

      // Manejar click del botón instalar
      if (installBtn) {
        installBtn.addEventListener("click", async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`PWA: User response to the install prompt: ${outcome}`);
            deferredPrompt = null;
            installBtn.classList.add("hidden");
          }
        });
      }

      // Detectar cuando la app ya está instalada
      window.addEventListener("appinstalled", (evt) => {
        console.log("PWA: App was installed");
        installBtn.classList.add("hidden");

        // Mostrar notificación de éxito
        if (window.showNotification) {
          showNotification("¡App instalada exitosamente!", "success");
        }
      });

      // Detectar si se está ejecutando como PWA
      function isPWA() {
        return (
          window.matchMedia("(display-mode: standalone)").matches ||
          window.navigator.standalone ||
          document.referrer.includes("android-app://")
        );
      }

      // Configuración específica para PWA
      if (isPWA()) {
        console.log("PWA: Ejecutándose como PWA");
        document.body.classList.add("pwa-mode");
      }

      // Manejar errores de carga de recursos
      window.addEventListener("error", (e) => {
        console.error(
          "PWA: Error loading resource:",
          e.filename,
          e.lineno,
          e.colno,
          e.error
        );
      });

      // Manejar errores no capturados
      window.addEventListener("unhandledrejection", (e) => {
        console.error("PWA: Unhandled promise rejection:", e.reason);
      });
    </script>
  </body>
</html>
