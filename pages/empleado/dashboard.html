<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Empleado - PWA Sistema</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="manifest" href="../../manifest.json" />
    <link rel="stylesheet" href="../../assets/css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-gray-100">
    <div class="flex min-h-screen">
        <div id="sidebarContainer"></div>

        <div class="flex-1 flex flex-col">
            <div id="headerContainer"></div>

            <main class="flex-1 p-4 sm:p-6 lg:p-8">
          <!-- Welcome Banner -->
          <div
            class="bg-gradient-to-r from-green-600 to-green-800 rounded-lg shadow-lg p-6 mb-8 text-white"
          >
            <h2 id="welcomeText" class="text-2xl font-bold">
              ¡Bienvenido Empleado!
            </h2>
            <p class="mt-2">
              Panel de control para gestión de inventario y ventas
            </p>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm">Ventas Hoy</p>
                  <p
                    id="ventasHoy"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    $0
                  </p>
                </div>
                <div class="bg-green-100 rounded-full p-4">
                  <i class="fas fa-dollar-sign text-3xl text-green-600"></i>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm">Pedidos Pendientes</p>
                  <p
                    id="pedidosPendientes"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                </div>
                <div class="bg-blue-100 rounded-full p-4">
                  <i class="fas fa-clock text-3xl text-blue-600"></i>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm">Productos Bajo Stock</p>
                  <p
                    id="productosBajoStock"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                </div>
                <div class="bg-yellow-100 rounded-full p-4">
                  <i
                    class="fas fa-exclamation-triangle text-3xl text-yellow-600"
                  ></i>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm">Total Productos</p>
                  <p
                    id="totalProductos"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                </div>
                <div class="bg-purple-100 rounded-full p-4">
                  <i class="fas fa-box text-3xl text-purple-600"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Tareas Rápidas -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-bold text-gray-900 mb-4">
                Acciones Rápidas
              </h3>
              <div class="space-y-3">
                <button
                  onclick="alert('Funcionalidad en desarrollo')"
                  class="w-full btn-primary py-3 text-left"
                >
                  <i class="fas fa-plus-circle mr-3"></i> Registrar Venta
                </button>
                <button
                  onclick="alert('Funcionalidad en desarrollo')"
                  class="w-full btn-secondary py-3 text-left"
                >
                  <i class="fas fa-boxes mr-3"></i> Actualizar Inventario
                </button>
                <button
                  onclick="alert('Funcionalidad en desarrollo')"
                  class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-md text-left"
                >
                  <i class="fas fa-headset mr-3"></i> Atender Cliente
                </button>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
              <h3 class="text-lg font-bold text-gray-900 mb-4">
                Alertas de Inventario
              </h3>
              <div
                id="inventoryAlerts"
                class="space-y-2 max-h-64 overflow-y-auto"
              >
                <!-- Alertas dinámicas -->
              </div>
            </div>
          </div>

          <!-- Pedidos Recientes -->
          <div class="bg-white rounded-lg shadow-md">
            <div class="p-6 border-b">
              <h3 class="text-lg font-bold text-gray-900">
                Pedidos Pendientes de Procesar
              </h3>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Pedido
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Cliente
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Fecha
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Total
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Estado
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Acción
                    </th>
                  </tr>
                </thead>
                <tbody
                  id="ordersTableBody"
                  class="bg-white divide-y divide-gray-200"
                ></tbody>
              </table>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/data.js"></script>
    <script src="../../components/components.js"></script>
    <script>
      protectPage("empleado");
      document.getElementById("sidebarContainer").innerHTML =
        createEmpleadoSidebar();
      document.getElementById("headerContainer").innerHTML =
        createHeader("Dashboard");

      const user = getCurrentUser();
      document.getElementById(
        "welcomeText"
      ).textContent = `¡Bienvenido ${user.nombre}!`;

      function loadStats() {
        const stats = getDashboardStats();

        document.getElementById("ventasHoy").textContent = Format.currency(
          stats.ventasHoy
        );
        document.getElementById("pedidosPendientes").textContent =
          stats.pedidosPendientes;
        document.getElementById("productosBajoStock").textContent =
          stats.productosBajoStock;
        document.getElementById("totalProductos").textContent =
          stats.totalProductos;
      }

      function loadInventoryAlerts() {
        const products = getProducts({ activeOnly: true });
        const lowStock = products.filter((p) => p.stock < 10);
        const container = document.getElementById("inventoryAlerts");

        if (lowStock.length === 0) {
          container.innerHTML =
            '<p class="text-gray-500 text-sm">No hay alertas de inventario</p>';
          return;
        }

        container.innerHTML = lowStock
          .map(
            (product) => `
                <div class="flex items-center justify-between p-3 bg-yellow-50 rounded border border-yellow-200">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
                        <div>
                            <p class="font-semibold text-sm text-gray-900">${product.nombre}</p>
                            <p class="text-xs text-gray-600">Stock: ${product.stock} unidades</p>
                        </div>
                    </div>
                    <button class="text-blue-600 hover:text-blue-700 text-sm">Reponer</button>
                </div>
            `
          )
          .join("");
      }

      function loadPendingOrders() {
        const orders = getOrders({ estado: "pendiente" });
        const tbody = document.getElementById("ordersTableBody");

        if (orders.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No hay pedidos pendientes</td></tr>';
          return;
        }

        tbody.innerHTML = orders
          .map(
            (order) => `
                <tr>
                    <td class="px-6 py-4 font-medium text-gray-900">#${
                      order.id
                    }</td>
                    <td class="px-6 py-4 text-gray-900">${order.cliente}</td>
                    <td class="px-6 py-4 text-gray-500">${Format.date(
                      order.fecha,
                      "short"
                    )}</td>
                    <td class="px-6 py-4 font-semibold text-gray-900">${Format.currency(
                      order.total
                    )}</td>
                    <td class="px-6 py-4"><span class="badge badge-warning">Pendiente</span></td>
                    <td class="px-6 py-4">
                        <button onclick="processOrder(${
                          order.id
                        })" class="btn-primary px-3 py-1 text-sm">
                            Procesar
                        </button>
                    </td>
                </tr>
            `
          )
          .join("");
      }

      function processOrder(orderId) {
        confirmAction("¿Marcar pedido como en proceso?", () => {
          updateOrderStatus(orderId, "en proceso");
          showNotification("Pedido actualizado", "success");
          loadPendingOrders();
          loadStats();
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadStats();
        loadInventoryAlerts();
        loadPendingOrders();
      });

      window.processOrder = processOrder;
    </script>
  </body>
</html>
