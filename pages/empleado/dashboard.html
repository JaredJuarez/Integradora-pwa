<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rutas del Día - Empleado</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="manifest" href="../../manifest.json" />
    <link rel="stylesheet" href="../../assets/css/styles.css" />

    <style>
      /* Estilos específicos para móvil */
      body {
        background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        min-height: 100vh;
      }

      .store-card {
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .store-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .store-card.completed {
        opacity: 0.6;
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        color: white;
      }

      .mobile-header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stats-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body>
    <!-- Header Móvil -->
    <div class="mobile-header sticky top-0 z-50">
      <div class="max-w-md mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center"
            >
              <i class="fas fa-truck text-white text-sm"></i>
            </div>
            <div>
              <h1 id="employeeName" class="text-lg font-bold text-gray-800">
                Carlos Mendoza
              </h1>
              <p class="text-sm text-gray-600">Rutas del día</p>
            </div>
          </div>
          <button
            onclick="logout()"
            class="p-2 text-gray-600 hover:text-red-500"
          >
            <i class="fas fa-sign-out-alt text-xl"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="max-w-md mx-auto px-4 pb-20">
      <!-- Estadísticas Rápidas -->
      <div class="grid grid-cols-3 gap-3 mt-4 mb-6">
        <div class="stats-card rounded-lg p-3 text-center">
          <div class="text-2xl font-bold text-gray-700" id="tiendasCompletadas">
            0
          </div>
          <div class="text-xs text-gray-600">Completadas</div>
        </div>
        <div class="stats-card rounded-lg p-3 text-center">
          <div
            class="text-2xl font-bold text-orange-600"
            id="tiendasPendientes"
          >
            5
          </div>
          <div class="text-xs text-gray-600">Pendientes</div>
        </div>
        <div class="stats-card rounded-lg p-3 text-center">
          <div
            class="text-2xl font-bold text-green-600"
            id="productosEntregados"
          >
            0
          </div>
          <div class="text-xs text-gray-600">Productos</div>
        </div>
      </div>

      <!-- Mensaje de estado -->
      <div id="estadoRuta" class="bg-white rounded-lg p-4 mb-4 shadow-md">
        <div class="flex items-center space-x-3">
          <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
          <span class="text-gray-800 font-medium"
            >Ruta activa - Listo para visitar tiendas</span
          >
        </div>
      </div>

      <!-- Lista de Tiendas -->
      <div class="space-y-4">
        <h2 class="text-white text-lg font-bold mb-3">
          <i class="fas fa-store mr-2"></i>Tiendas Asignadas
        </h2>

        <!-- Contenedor de las cards de tiendas -->
        <div id="tiendasContainer" class="space-y-3">
          <!-- Las cards se generarán dinámicamente -->
        </div>
      </div>

      <!-- Botón de acción flotante -->
      <div id="fabButton" class="fixed bottom-6 right-6 hidden">
        <button
          onclick="completarRuta()"
          class="w-14 h-14 bg-green-500 hover:bg-green-600 rounded-full shadow-lg flex items-center justify-center text-white"
        >
          <i class="fas fa-check text-xl"></i>
        </button>
      </div>

      <!-- Modal de completar ruta -->
      <div
        id="modalCompletarRuta"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"
      >
        <div class="flex items-center justify-center min-h-screen p-4">
          <div class="bg-white rounded-lg max-w-sm w-full p-6">
            <div class="text-center">
              <div
                class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
              >
                <i class="fas fa-check-circle text-green-500 text-2xl"></i>
              </div>
              <h3 class="text-lg font-bold text-gray-800 mb-2">
                ¡Ruta Completada!
              </h3>
              <p class="text-gray-600 mb-6">
                Has terminado todas las visitas del día. ¡Excelente trabajo!
              </p>
              <button
                onclick="cerrarModalRuta()"
                class="w-full btn-primary py-3 rounded-lg font-medium"
              >
                Entendido
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/data.js"></script>
    <script src="../../assets/js/employee-data.js"></script>

    <script>
      // Proteger página solo para empleados
      protectPage("empleado");

      // Inicializar datos del empleado
      initEmpleadoData();

      let empleadoActual;
      let estadisticas;

      function initDashboard() {
        empleadoActual = getCurrentUser();
        if (!empleadoActual) {
          window.location.href = "../auth/login.html";
          return;
        }

        // Actualizar nombre del empleado
        document.getElementById("employeeName").textContent =
          empleadoActual.nombre;

        // Cargar datos
        cargarEstadisticas();
        cargarTiendasAsignadas();
      }

      function cargarEstadisticas() {
        estadisticas = getEstadisticasEmpleado(empleadoActual.id);

        document.getElementById("tiendasCompletadas").textContent =
          estadisticas.tiendasCompletadas;
        document.getElementById("tiendasPendientes").textContent =
          estadisticas.tiendasPendientes;
        document.getElementById("productosEntregados").textContent =
          estadisticas.productosEntregadosHoy;

        // Mostrar botón FAB si la ruta está completada
        if (estadisticas.rutaCompletada) {
          document.getElementById("fabButton").classList.remove("hidden");
          document.getElementById("estadoRuta").innerHTML = `
            <div class="flex items-center space-x-3">
              <div class="w-3 h-3 bg-green-500 rounded-full"></div>
              <span class="text-gray-800 font-medium">Ruta completada - ¡Buen trabajo!</span>
            </div>
          `;
        }
      }

      function cargarTiendasAsignadas() {
        const tiendas = getTiendasAsignadasEmpleado(empleadoActual.id);
        const container = document.getElementById("tiendasContainer");

        if (tiendas.length === 0) {
          container.innerHTML = `
            <div class="bg-white rounded-lg p-6 text-center">
              <i class="fas fa-calendar-times text-gray-400 text-3xl mb-3"></i>
              <p class="text-gray-600">No hay tiendas asignadas para hoy</p>
            </div>
          `;
          return;
        }

        container.innerHTML = tiendas
          .map((tienda) => {
            const isCompleted = tienda.estado === "completada";
            const cardClass = isCompleted
              ? "store-card completed"
              : "store-card bg-white";
            const actionButton = isCompleted
              ? '<span class="text-white text-sm"><i class="fas fa-check-circle mr-1"></i>Completada</span>'
              : '<span class="text-gray-700 text-sm font-medium">Visitar <i class="fas fa-arrow-right ml-1"></i></span>';

            return `
            <div class="${cardClass} rounded-lg p-4 shadow-md ${
              isCompleted ? "" : "cursor-pointer"
            }" 
                 ${
                   isCompleted ? "" : `onclick="visitarTienda('${tienda.id}')"`
                 }>
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center space-x-2 mb-2">
                    <i class="fas fa-store text-lg ${
                      isCompleted ? "text-white" : "text-gray-700"
                    }"></i>
                    <h3 class="font-bold text-lg ${
                      isCompleted ? "text-white" : "text-gray-800"
                    }">${tienda.nombre}</h3>
                  </div>
                  
                  <p class="text-sm ${
                    isCompleted ? "text-gray-100" : "text-gray-600"
                  } mb-3 flex items-start">
                    <i class="fas fa-map-marker-alt mt-1 mr-2 flex-shrink-0"></i>
                    ${tienda.direccion}
                  </p>
                  
                  <div class="flex items-center justify-between">
                    <div class="text-xs ${
                      isCompleted ? "text-gray-200" : "text-gray-500"
                    } flex items-center">
                      <i class="fas fa-clock mr-1"></i>
                      ${tienda.horario}
                    </div>
                    ${actionButton}
                  </div>
                </div>
              </div>
            </div>
          `;
          })
          .join("");
      }

      function visitarTienda(tiendaId) {
        // Guardar ID de tienda a visitar en sessionStorage
        sessionStorage.setItem("tiendaAVisitar", tiendaId);

        // Redirigir a página de escaneo QR
        window.location.href = "./qr-scanner.html";
      }

      function completarRuta() {
        document
          .getElementById("modalCompletarRuta")
          .classList.remove("hidden");
      }

      function cerrarModalRuta() {
        document.getElementById("modalCompletarRuta").classList.add("hidden");
      }

      // Inicializar cuando la página carga
      document.addEventListener("DOMContentLoaded", initDashboard);
    </script>
  </body>
</html>
