<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#4F46E5" />
    <title>Dashboard Administrador - PWA Sistema</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="manifest" href="../../manifest.json" />
    <link rel="stylesheet" href="../../assets/css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-gray-100">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <div id="sidebarContainer"></div>

      <!-- Main content -->
      <div class="flex-1 flex flex-col">
        <!-- Header -->
        <div id="headerContainer"></div>

        <!-- Content -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8">
          <!-- Stats Cards -->
          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
          >
            <!-- Tiendas Activas -->
            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">
                    Tiendas Activas
                  </p>
                  <p
                    id="tiendasActivas"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                  <p class="text-green-600 text-sm mt-1">
                    <i class="fas fa-check-circle"></i>
                    <span id="tiendasAsignadas">0</span> asignadas
                  </p>
                </div>
                <div class="bg-indigo-100 rounded-full p-4">
                  <i class="fas fa-store text-3xl text-indigo-600"></i>
                </div>
              </div>
            </div>

            <!-- Tiendas -->
            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Tiendas</p>
                  <p
                    id="totalTiendas"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                  <p class="text-yellow-600 text-sm mt-1">
                    <i class="fas fa-calendar-check"></i>
                    <span id="tiendasVisitarHoy">0</span> visitas hoy
                  </p>
                </div>
                <div class="bg-blue-100 rounded-full p-4">
                  <i class="fas fa-store text-3xl text-blue-600"></i>
                </div>
              </div>
            </div>

            <!-- Productos -->
            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Productos</p>
                  <p
                    id="totalProductos"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                  <p class="text-blue-600 text-sm mt-1">
                    <i class="fas fa-box"></i>
                    <span id="categoriasProductos">0</span> categorías
                  </p>
                </div>
                <div class="bg-green-100 rounded-full p-4">
                  <i class="fas fa-box text-3xl text-green-600"></i>
                </div>
              </div>
            </div>

            <!-- Empleados -->
            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Empleados</p>
                  <p
                    id="totalEmpleados"
                    class="text-3xl font-bold text-gray-900 mt-2"
                  >
                    0
                  </p>
                  <p class="text-indigo-600 text-sm mt-1">
                    <i class="fas fa-user-check"></i>
                    <span id="empleadosActivos">0</span> activos
                  </p>
                </div>
                <div class="bg-purple-100 rounded-full p-4">
                  <i class="fas fa-users text-3xl text-purple-600"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Accesos Rápidos -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <a
              href="empleados-management.html"
              class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow"
            >
              <div class="flex items-center">
                <div class="bg-purple-100 rounded-full p-4 mr-4">
                  <i class="fas fa-users text-3xl text-purple-600"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">
                    Gestionar Empleados
                  </h3>
                  <p class="text-sm text-gray-600">CRUD de empleados</p>
                </div>
              </div>
            </a>

            <a
              href="tiendas-management.html"
              class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow"
            >
              <div class="flex items-center">
                <div class="bg-blue-100 rounded-full p-4 mr-4">
                  <i class="fas fa-store text-3xl text-blue-600"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">
                    Gestionar Tiendas
                  </h3>
                  <p class="text-sm text-gray-600">CRUD y asignaciones</p>
                </div>
              </div>
            </a>

            <a
              href="productos-management.html"
              class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow"
            >
              <div class="flex items-center">
                <div class="bg-green-100 rounded-full p-4 mr-4">
                  <i class="fas fa-box text-3xl text-green-600"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">
                    Gestionar Productos
                  </h3>
                  <p class="text-sm text-gray-600">Catálogo de productos</p>
                </div>
              </div>
            </a>
          </div>

          <!-- Resumen de Actividad -->
          <div class="bg-white rounded-lg shadow-md">
            <div class="p-6 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">
                Resumen del Sistema
              </h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h4 class="text-md font-semibold text-gray-700 mb-3">
                    Tiendas por Empleado
                  </h4>
                  <div id="storesByEmployee" class="space-y-2">
                    <p class="text-sm text-gray-600">Cargando...</p>
                  </div>
                </div>
                <div>
                  <h4 class="text-md font-semibold text-gray-700 mb-3">
                    Actividad Reciente
                  </h4>
                  <div id="recentActivity" class="space-y-2">
                    <p class="text-sm text-gray-600">
                      No hay actividad reciente
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/mock-api.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/data.js"></script>
    <script src="../../assets/js/admin-data.js"></script>
    <script src="../../components/components.js"></script>
    <script>
      // Proteger página - solo administradores
      protectPage("administrador");

      // Cargar componentes
      document.getElementById("sidebarContainer").innerHTML =
        createAdminSidebar();
      document.getElementById("headerContainer").innerHTML =
        createHeader("Dashboard");

      // Cargar estadísticas
      function loadStats() {
        // Obtener estadísticas reales de adminDataManager
        const stats = adminDataManager.getAdminStats();

        // Tiendas Activas
        document.getElementById("tiendasActivas").textContent =
          stats.tiendasActivas;
        document.getElementById("tiendasAsignadas").textContent =
          stats.tiendasAsignadas;

        // Tiendas (segunda tarjeta)
        document.getElementById("totalTiendas").textContent =
          stats.totalTiendas;
        document.getElementById("tiendasVisitarHoy").textContent =
          stats.tiendasVisitarHoy;

        // Productos
        document.getElementById("totalProductos").textContent =
          stats.totalProductos;
        document.getElementById("categoriasProductos").textContent =
          stats.categorias;

        // Empleados
        document.getElementById("totalEmpleados").textContent =
          stats.totalEmpleados;
        document.getElementById("empleadosActivos").textContent =
          stats.empleadosActivos;
      }

      // Gráfico de ventas mensuales
      function createSalesChart() {
        const ctx = document.getElementById("salesChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Ene", "Feb", "Mar", "Abr", "May", "Jun"],
            datasets: [
              {
                label: "Ventas 2025",
                data: [45000, 52000, 48000, 61000, 58000, 75000],
                borderColor: "rgb(79, 70, 229)",
                backgroundColor: "rgba(79, 70, 229, 0.1)",
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return "$" + value.toLocaleString();
                  },
                },
              },
            },
          },
        });
      }

      // Gráfico de productos más vendidos
      function createProductsChart() {
        const ctx = document.getElementById("productsChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["Laptop", "iPhone", "Samsung", "iPad", "Audífonos"],
            datasets: [
              {
                label: "Unidades Vendidas",
                data: [45, 62, 38, 29, 55],
                backgroundColor: [
                  "rgba(79, 70, 229, 0.8)",
                  "rgba(59, 130, 246, 0.8)",
                  "rgba(16, 185, 129, 0.8)",
                  "rgba(249, 115, 22, 0.8)",
                  "rgba(236, 72, 153, 0.8)",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      // Cargar pedidos recientes
      function loadRecentOrders() {
        const orders = getOrders().slice(0, 5); // Últimos 5 pedidos
        const tbody = document.getElementById("ordersTableBody");

        if (orders.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            No hay pedidos recientes
                        </td>
                    </tr>
                `;
          return;
        }

        tbody.innerHTML = orders
          .map((order) => {
            const statusInfo = ORDER_STATUSES.find(
              (s) => s.value === order.estado
            );
            const badgeColor = statusInfo ? statusInfo.color : "gray";

            return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            #${order.id}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${order.cliente}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${Format.date(order.fecha, "short")}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                            ${Format.currency(order.total)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="badge badge-${
                              badgeColor === "green"
                                ? "success"
                                : badgeColor === "red"
                                ? "danger"
                                : badgeColor === "yellow"
                                ? "warning"
                                : "primary"
                            }">
                                ${statusInfo ? statusInfo.label : order.estado}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="viewOrder(${
                              order.id
                            })" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
          })
          .join("");
      }

      function viewOrder(orderId) {
        const order = getOrderById(orderId);
        if (!order) return;

        const productsList = order.productos
          .map(
            (p) =>
              `<li>${p.nombre} - ${p.cantidad}x ${Format.currency(
                p.precio
              )}</li>`
          )
          .join("");

        showModal(
          `Pedido #${order.id}`,
          `
                    <div class="space-y-3">
                        <p><strong>Cliente:</strong> ${order.cliente}</p>
                        <p><strong>Fecha:</strong> ${Format.date(
                          order.fecha
                        )}</p>
                        <p><strong>Estado:</strong> <span class="badge badge-primary">${
                          order.estado
                        }</span></p>
                        <div>
                            <strong>Productos:</strong>
                            <ul class="list-disc pl-5 mt-2">${productsList}</ul>
                        </div>
                        <p><strong>Total:</strong> <span class="text-xl font-bold">${Format.currency(
                          order.total
                        )}</span></p>
                        <p><strong>Dirección:</strong> ${order.direccion}</p>
                    </div>
                `,
          [{ text: "Cerrar", type: "primary", onclick: "closeModal()" }]
        );
      }

      // Cargar resumen de tiendas por empleado
      function loadStoresByEmployee() {
        const employees = adminDataManager.getAllEmployees();
        const stores = adminDataManager.getAllStores();
        const container = document.getElementById("storesByEmployee");

        if (employees.length === 0) {
          container.innerHTML =
            '<p class="text-sm text-gray-600">No hay empleados registrados</p>';
          return;
        }

        const html = employees
          .map((emp) => {
            const assignedStores = stores.filter(
              (s) => s.empleadoAsignado === emp.id
            );
            return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <span class="text-sm text-gray-700">${emp.nombre}</span>
                        <span class="text-sm font-semibold text-gray-900">${
                          assignedStores.length
                        } tienda${assignedStores.length !== 1 ? "s" : ""}</span>
                    </div>
                `;
          })
          .join("");

        container.innerHTML = html;
      }

      // Inicializar
      document.addEventListener("DOMContentLoaded", () => {
        loadStats();
        loadStoresByEmployee();
      });
    </script>
  </body>
</html>
