<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Cliente - PWA Sistema</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="../../manifest.json">
    <link rel="stylesheet" href="../../assets/css/styles.css">
</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <div id="sidebarContainer"></div>

        <div class="flex-1 flex flex-col">
            <div id="headerContainer"></div>

            <main class="flex-1 p-4 sm:p-6 lg:p-8">
                <!-- Welcome Banner -->
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg shadow-lg p-6 mb-8 text-white">
                    <h2 id="welcomeText" class="text-2xl font-bold">¡Bienvenido!</h2>
                    <p class="mt-2">Explora nuestro catálogo y encuentra los mejores productos</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Mis Pedidos</p>
                                <p id="totalPedidos" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                            </div>
                            <div class="bg-blue-100 rounded-full p-4">
                                <i class="fas fa-shopping-bag text-3xl text-blue-600"></i>
                            </div>
                        </div>
                        <a href="historial-pedidos.html" class="text-blue-600 hover:text-blue-700 text-sm mt-4 inline-block">
                            Ver historial <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Carrito</p>
                                <p id="cartItems" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                            </div>
                            <div class="bg-green-100 rounded-full p-4">
                                <i class="fas fa-shopping-cart text-3xl text-green-600"></i>
                            </div>
                        </div>
                        <a href="carrito.html" class="text-green-600 hover:text-green-700 text-sm mt-4 inline-block">
                            Ir al carrito <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Favoritos</p>
                                <p id="favoritesCount" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                            </div>
                            <div class="bg-red-100 rounded-full p-4">
                                <i class="fas fa-heart text-3xl text-red-600"></i>
                            </div>
                        </div>
                        <a href="favoritos.html" class="text-red-600 hover:text-red-700 text-sm mt-4 inline-block">
                            Ver favoritos <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>

                <!-- Productos Destacados -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Productos Destacados</h3>
                        <a href="productos.html" class="text-blue-600 hover:text-blue-700 font-medium">
                            Ver todos <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                    <div id="featuredProducts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Productos cargados dinámicamente -->
                    </div>
                </div>

                <!-- Categorías -->
                <div>
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Comprar por Categoría</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <a href="productos.html?categoria=Electrónica" class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition card-hover">
                            <i class="fas fa-laptop text-4xl text-blue-600 mb-3"></i>
                            <p class="font-semibold text-gray-900">Electrónica</p>
                        </a>
                        <a href="productos.html?categoria=Audio" class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition card-hover">
                            <i class="fas fa-headphones text-4xl text-green-600 mb-3"></i>
                            <p class="font-semibold text-gray-900">Audio</p>
                        </a>
                        <a href="productos.html?categoria=Gaming" class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition card-hover">
                            <i class="fas fa-gamepad text-4xl text-purple-600 mb-3"></i>
                            <p class="font-semibold text-gray-900">Gaming</p>
                        </a>
                        <a href="productos.html?categoria=Fotografía" class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition card-hover">
                            <i class="fas fa-camera text-4xl text-red-600 mb-3"></i>
                            <p class="font-semibold text-gray-900">Fotografía</p>
                        </a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/data.js"></script>
    <script src="../../components/components.js"></script>
    <script>
        protectPage('cliente');
        document.getElementById('sidebarContainer').innerHTML = createClienteSidebar();
        document.getElementById('headerContainer').innerHTML = createHeader('Dashboard');
        updateCartBadge();

        // Mensaje de bienvenida personalizado
        const user = getCurrentUser();
        document.getElementById('welcomeText').textContent = `¡Bienvenido ${user.nombre}!`;

        // Cargar estadísticas
        function loadStats() {
            const orders = getOrders({ clienteId: user.id });
            const cart = Storage.get('cart') || [];
            const favorites = Storage.get('favorites') || [];
            
            document.getElementById('totalPedidos').textContent = orders.length;
            document.getElementById('cartItems').textContent = cart.reduce((sum, item) => sum + item.cantidad, 0);
            document.getElementById('favoritesCount').textContent = favorites.length;
        }

        // Cargar productos destacados
        function loadFeaturedProducts() {
            const products = getProducts({ activeOnly: true }).slice(0, 4);
            const container = document.getElementById('featuredProducts');
            
            container.innerHTML = products.map(product => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover">
                    <img src="${product.imagen}" alt="${product.nombre}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">${Format.truncate(product.nombre, 30)}</h4>
                        <p class="text-sm text-gray-600 mb-3">${Format.truncate(product.descripcion, 50)}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-blue-600">${Format.currency(product.precio)}</span>
                            <button onclick="addToCart(${product.id})" class="btn-primary px-4 py-2 text-sm">
                                <i class="fas fa-cart-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Agregar al carrito
        function addToCart(productId) {
            const product = getProductById(productId);
            if (!product) return;
            
            let cart = Storage.get('cart') || [];
            const existingItem = cart.find(item => item.productoId === productId);
            
            if (existingItem) {
                existingItem.cantidad++;
            } else {
                cart.push({
                    productoId: productId,
                    nombre: product.nombre,
                    precio: product.precio,
                    imagen: product.imagen,
                    cantidad: 1
                });
            }
            
            Storage.set('cart', cart);
            showNotification('Producto agregado al carrito', 'success');
            updateCartBadge();
            loadStats();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadFeaturedProducts();
        });

        window.addToCart = addToCart;
    </script>
</body>
</html>
